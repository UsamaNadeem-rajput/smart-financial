# Backend API .htaccess for OrangeHost
<IfModule mod_rewrite.c>
  RewriteEngine On
  RewriteBase /api/
  
  # Route all API requests to server.js if Node.js is available
  # Otherwise, route to PHP files
  
  # Check if Node.js server is running
  RewriteCond %{REQUEST_FILENAME} !-f
  RewriteCond %{REQUEST_FILENAME} !-d
  RewriteRule ^(.*)$ server.js [L,QSA]
  
  # If Node.js is not available, uncomment the following lines
  # and use PHP backend instead
  # RewriteCond %{REQUEST_FILENAME} !-f
  # RewriteCond %{REQUEST_FILENAME} !-d
  # RewriteRule ^(.*)$ index.php [L,QSA]
</IfModule>

# Security headers
<IfModule mod_headers.c>
  Header always set Access-Control-Allow-Origin "https://yourdomain.com"
  Header always set Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS"
  Header always set Access-Control-Allow-Headers "Content-Type, Authorization, X-Requested-With"
  Header always set Access-Control-Allow-Credentials "true"
  Header always set X-Content-Type-Options nosniff
  Header always set X-Frame-Options DENY
  Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# Handle preflight requests
<IfModule mod_rewrite.c>
  RewriteCond %{REQUEST_METHOD} OPTIONS
  RewriteRule ^(.*)$ $1 [R=200,L]
</IfModule>

# Prevent access to sensitive files
<Files ~ "^\.">
  Order allow,deny
  Deny from all
</Files>

<Files ~ "\.env$">
  Order allow,deny
  Deny from all
</Files>

<Files ~ "package\.json$">
  Order allow,deny
  Deny from all
</Files>

# Enable compression for API responses
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE application/json
  AddOutputFilterByType DEFLATE text/plain
  AddOutputFilterByType DEFLATE text/html
</IfModule>